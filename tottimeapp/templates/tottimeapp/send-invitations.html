{% extends 'tottimeapp/base.html' %}
{% load static %} 
{% load custom_filters %}
{% load dict_extras %}
{% block title %}Send Invitation{% endblock %}

{% block styles %}
<style>
.btn-secondary {
    margin-left: 10px; 
    margin-bottom: 25px; /* Remove bottom margin */
}
.form-label {
    margin-top: 30px;
    margin-left: 15px;
}
input {
        margin-left: 15px;
        width: 180px!important; /* Adjust the width as needed */
    }
    select {
        margin-left: 15px;
        width: 180px!important; 
        margin-top: 15px;
        margin-bottom: 25px;    
    }
</style>
{% endblock %}

{% block content %}
                <div class="container-fluid px-4">
                    <h1>Send Invite Link</h1>
                    <form method="post">
                    {% csrf_token %}
                    <label for="email" class="form-label">Email:</label>
                    <input type="email" id="email" name="email" class="form-control" required>
                    <select id="role" name="role" class="form-control" required onchange="toggleStudentSelect()">
                        <option value="" disabled selected>Select a role</option>
                        {% for role in roles %}
                            <option value="{{ role.id }}" data-role-name="{{ role.name|lower }}">{{ role.name }}</option>
                        {% endfor %}
                    </select>
                    <div id="student-select-container" style="display:none;">
                        <label for="student_ids" class="form-label">Link Students:</label>
                        <select id="student_ids" name="student_ids" class="form-control" multiple>
                            {% for student in students %}
                                <option value="{{ student.id }}">{{ student.first_name }} {{ student.last_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Invitation</button>
                    <button type="button" class="btn btn-secondary" onclick="window.history.back();">Cancel</button>
                </form>
                    
                    {% if success_message %}
                        <p style="color: green;">{{ success_message }}</p>  <!-- Display the success message -->
                    {% endif %}
                    
                </div>
{% endblock %}

{% block scripts %}   
<script>
function toggleStudentSelect() {
    var roleSelect = document.getElementById('role');
    var selectedOption = roleSelect.options[roleSelect.selectedIndex];
    var roleName = selectedOption.getAttribute('data-role-name');
    var studentContainer = document.getElementById('student-select-container');
    if (roleName === 'parent' || roleName === 'teacher-parent') {
        studentContainer.style.display = '';
    } else {
        studentContainer.style.display = 'none';
    }
}

// Initialize Select2 on the student_ids select
document.addEventListener('DOMContentLoaded', function() {
    $('#student_ids').select2({
        placeholder: "Select students...",
        width: '100%'
    });
});
</script>
{% endblock %}