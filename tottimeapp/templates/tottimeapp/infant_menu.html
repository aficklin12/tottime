{% extends 'tottimeapp/base.html' %}
{% load static %} 
{% load custom_filters %}
{% load dict_extras %}
{% block title %}Infant Menus{% endblock %}

{% block styles %}
<style>
.form-container {
    max-width: 1200px; /* Increased from 1000px */
    margin: 0 auto;
    padding: 20px;
    font-family: Arial, sans-serif;
    font-size: 12px;
}

.header-text {
    text-align: center;
    margin-bottom: 20px;
}

.header-text h3 {
    margin: 5px 0;
    font-size: 14px;
}

.info-section {
    margin-bottom: 20px;
    text-align: center; /* Center the info section */
}

.info-row {
    display: flex;
    margin-bottom: 10px;
    align-items: center;
    justify-content: center; /* Center the flex content */
}

.info-row label {
    margin-right: 10px;
}

.checkbox-group {
    margin: 0 20px;
}

.requirements-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.requirements-table th,
.requirements-table td {
    border: 1px solid black;
    padding: 8px;
    text-align: left;
    vertical-align: top;
}

.requirements-table th {
    background-color: black;
    color: white;
    font-weight: bold;
}

/* Center the requirements table header */
.requirements-table th[colspan="4"] {
    text-align: center;
}

.age-column {
    width: 60px;
}

.meal-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1100px; /* Added minimum width */
}

.meal-table th,
.meal-table td {
    border: 1px solid black;
    padding: 8px;
    vertical-align: middle; /* Center all content vertically */
    height: 50px; /* Increased height for better dropdown and checkbox fit */
}

.meal-table th {
    background-color: black;
    color: white;
    font-weight: bold;
}


.day-column {
    width: 16%; /* Increased from 15% */
}

/* Add specific width for the Date column */
.meal-table th:nth-child(2),
.meal-table td:nth-child(2) {
    width: 18%; /* Increased from 15% */
    text-align: left;
}

.checkbox-cell {
    text-align: center;
}

.footnote {
    font-size: 10px;
    margin-top: 10px;
}
.meal-section {
    background-color: rgb(0, 0, 0);
    color: white;
    font-weight: bold;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    text-align: center!important;
    vertical-align: middle !important;
    width: 60px;
    position: relative;
}

.dropdown-cell {
    padding: 2px;
    position: relative;
    text-align: center; /* Center the dropdown */
    vertical-align: middle; /* Center vertically */
}

.dropdown-cell select {
    width: 90%; /* Slightly smaller to center better */
    padding: 4px;
    border: 1px solid transparent; /* Make border transparent by default */
    font-size: 11px;
    background-color: transparent; /* Make background transparent */
    margin: 0 auto; /* Center the dropdown */
    display: block; /* Make it a block element for centering */
    appearance: none; /* Remove default dropdown arrow */
    -webkit-appearance: none;
    -moz-appearance: none;
}

/* Show border and background on hover */
.dropdown-cell select:hover {
    border: 2px solid #76cfdb88;
    background-color: white;
    border-radius: 6px; /* Round the corners */
}

/* Also show border and background when focused/clicked */
.dropdown-cell select:focus {
    border: 1px solid #007b8a;
    background-color: white;
    border-radius: 6px; /* Round the corners */
    outline: none;
}

/* Style dropdowns that have "Select Item" as the default */
.dropdown-cell select:invalid {
    color: #999; /* Grey out when no valid option is selected */
}

/* Style the "Select Item" placeholder option */
.dropdown-cell select option[value=""] {
    color: #999; /* Grey out the "Select Item" text */
    font-style: italic;
}

/* When a valid item is selected, make it black and keep options black */
.dropdown-cell select:valid {
    color: black;
}

.dropdown-cell select option:not([value=""]) {
    color: black; /* Keep all actual inventory options black */
}

/* Style for meal count number inputs */
input[type="number"] {
    border: 1px solid transparent; /* Make border transparent by default */
    background-color: transparent; /* Make background transparent */
    appearance: none; /* Remove default styling */
    -webkit-appearance: none;
    -moz-appearance: none;
    outline: none;
}

/* Show border and background on hover for number inputs */
input[type="number"]:hover {
    border: 1px solid #007b8a;
    background-color: white;
    border-radius: 6px; /* Round the corners */
}

/* Also show border and background when focused/clicked for number inputs */
input[type="number"]:focus {
    border: 1px solid #007b8a;
    background-color: white;
    border-radius: 6px; /* Round the corners */
    outline: none;
}

.checkbox-overlay {
    position: absolute;
    top: 2px;
    right: 2px;
    z-index: 10;
}

.checkbox-overlay input[type="checkbox"] {
    width: 12px;
    height: 12px;
}
</style>
{% endblock %}

{% block content %}
<h1>Infant Menus</h1> 
<div class="form-container">
    <form method="get" style="margin-bottom: 20px;">
        <select name="student" id="student" style="padding: 7px 10px; border: 1px solid #007b8a; border-radius: 5px; font-size: 14px; background: #fff; color: #222; margin-right: 10px;">
            <option value="" disabled {% if not selected_student_id %}selected{% endif %}>Select Student</option>
            {% for student in students %}
                <option value="{{ student.id }}" {% if student.id == selected_student_id %}selected{% endif %}>{{ student }}</option>
            {% endfor %}
        </select>
        <select name="week" id="week" style="padding: 7px 10px; border: 1px solid #007b8a; border-radius: 5px; font-size: 14px; background: #fff; color: #222;">
            {% for week in all_weeks %}
                <option value="{{ week.value }}" {% if week.value == selected_week %}selected{% endif %}>
                    {{ week.label }}
                </option>
            {% endfor %}
        </select>
    </form>

    <div class="header-text">
        <h3>South Carolina Department of Social Services</h3>
        <h3>Child and Adult Care Food Program</h3>
        <h3>INDIVIDUAL INFANT MEAL RECORD</h3>
    </div>

    <div class="info-section">
    <div class="info-row">
        <label>
            <strong>Center/Provider:</strong>
            {{ company_name }}{% if location_name %} - {{ location_name }}{% endif %}
        </label>
        <label>
            <strong>Formula:</strong>
            {% if formula_name %}
                {{ formula_name }}
            {% else %}
                _________________________
            {% endif %}
        </label>
        <label>
            <strong>Month:</strong> {{ month }}
        </label>
        <label>
            <strong>Year:</strong> {{ year }}
        </label>
    </div>
    <div class="info-row">
        <label>
            <strong>Infant Name:</strong>
            {% if selected_student %}
                {{ selected_student.first_name }} {{ selected_student.last_name }}
            {% else %}
                _________________________
            {% endif %}
        </label>
        <label>
            <strong>Birthdate:</strong>
            {% if selected_student %}
                {{ selected_student.date_of_birth|date:"m/d/Y" }}
            {% else %}
                _________
            {% endif %}
        </label>
        <div class="checkbox-group">
            <label>
                <strong>Medical Statement on File:</strong>
                <input type="radio" name="medical_statement" checked> Yes
                <input type="radio" name="medical_statement"> No
            </label>
        </div>
        <div class="checkbox-group">
            <label>
                <strong>Infant Statement on File:</strong>
                <input type="radio" name="infant_statement" checked> Yes
                <input type="radio" name="infant_statement"> No
            </label>
        </div>
    </div>
</div>

    <table class="requirements-table">
        <thead>
            <tr>
                <th colspan="4">Requirements for Infant Meal Pattern</th>
            </tr>
            <tr>
                <th class="age-column">Ages</th>
                <th>Breakfast</th>
                <th>Lunch or Supper</th>
                <th>Snack</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>0-3 mos.</td>
                <td>4-6 fl. oz. Breast Milk or Iron Fortified Infant Formula</td>
                <td>4-6 fl. oz. Breast Milk or Iron Fortified Infant Formula</td>
                <td>4-6 fl. oz. Breast Milk or Iron Fortified Infant Formula</td>
            </tr>
            <tr>
                <td>4-7 mos.</td>
                <td>4-8 fl. oz. Breast Milk or Iron Fortified Infant Formula<br>
                    0-3 tbsp. Iron Fortified Infant Cereal</td>
                <td>4-8 fl. oz. Breast Milk or Iron Fortified Infant Formula<br>
                    0-3 tbsp. Iron Fortified Infant Cereal<br>
                    0-3 tbsp. Fruit or Vegetable or both</td>
                <td>4-6 fl. oz. Breast Milk or Iron Fortified Infant Formula</td>
            </tr>
            <tr>
                <td>8-11 mos.</td>
                <td>6-8 fl. oz. Breast Milk or Iron Fortified Infant Formula <strong>and</strong><br>
                    2-4 tbsp. Iron Fortified Infant Cereal <strong>and</strong><br>
                    1-4 tbsp. Fruit or Vegetable or both</td>
                <td>6-8 fl. oz. Breast Milk or Iron Fortified Infant Formula <strong>and</strong><br>
                    2-4 tbsp. Iron Fortified Infant Cereal <strong>and/or</strong><br>
                    1-4 tbsp. Meat, Fish, Poultry, Egg Yolk, or Cooked Dry Beans or<br>
                    Peas; or Â½ -2 oz. of Cheese; or 1-4 oz. (volume) Cottage<br>
                    Cheese; or 1-4 oz. (weight) of Cheese Food or Cheese<br>
                    Spread; <strong>and</strong><br>
                    1-4 tbsp. Fruit or Vegetable or both</td>
                <td>2-4 fl. oz. Breast Milk or Iron Fortified Infant Formula<br>
                    <strong>or</strong> Fruit Juice <strong>and</strong><br>
                    0-1/2 Slice Bread <strong>or</strong><br>
                    0-2 Crackers</td>
            </tr>
        </tbody>
    </table>

    <table class="meal-table">
        <thead>
            <tr>
                <th></th>
                <th>Date</th>
                {% for day in week_dates %}
                    <th class="day-column">{{ day|date:"D, M d" }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for meal in meal_types %}
            <tr>
                <td rowspan="3" class="meal-section">{{ meal|upper }}</td>
                <td>Formula or Breast Milk</td>
                {% for day in week_dates %}
                <td class="dropdown-cell">
                    {% with cell=menu_data|get_item:day|get_item:meal %}
                        {% if cell.formula %}
                            {% for entry in cell.formula %}
                                {{ entry }}<br>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td>Infant Cereal / Meat / Meat Alternate</td>
                {% for day in week_dates %}
                <td class="dropdown-cell">
                    {% with cell=menu_data|get_item:day|get_item:meal %}
                        {% if cell.cereal %}
                            {% for entry in cell.cereal %}
                                {{ entry }}<br>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </td>
                {% endfor %}
            </tr>
            <tr>
                <td>Fruit / Vegetable</td>
                {% for day in week_dates %}
                <td class="dropdown-cell">
                    {% with cell=menu_data|get_item:day|get_item:meal %}
                        {% if cell.fruit %}
                            {% for entry in cell.fruit %}
                                {{ entry }}<br>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="footnote">
        DSS Form 16150 (DEC 11) Edition of MAR 01 is obsolete.
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.form-container form');
    document.getElementById('student').addEventListener('change', function() {
        form.submit();
    });
    document.getElementById('week').addEventListener('change', function() {
        form.submit();
    });
});
</script>
{% endblock %}