{% extends 'tottimeapp/base_dynamic.html' %}
{% load static %} 
{% load custom_filters %}
{% load dict_extras %}
{% block title %}Dashboard{% endblock %}

{% block styles %}
<style>
        .card-out-of-stock {
            width: 335px; /* Adjust the width as needed */
            height: 500px;
            margin-left: 10px; /* Adjust the margin as needed */
            
                }
               
        .card-out-of-stock .card-body {
            height: 590px; /* Set a fixed height to allow scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            align-items: center;
        }
        
        .card-out-of-stock .list-group-item {
            width: 260px;
            
            
        }
        
        @media (max-width: 999px) { /* Adjust the max-width as needed for your definition of smaller screens */
            .card-out-of-stock {
                margin-left: auto; /* Center horizontally */
                margin-right: auto;
            }
        }
        .bg-faded-red {
            background-color:  #2d2c30; /* Adjust the alpha value (last parameter) for the desired opacity */
            
        }
            .bg-faded-yellow {
            background-color:  #2d2c30; /* Adjust the alpha value (last parameter) for the desired opacity */
        }
        .bg-faded-blue {
            background-color:  #2d2c30; /* Adjust the alpha value (last parameter) for the desired opacity */
        }
        .bg-faded-green {
            background-color:  #2d2c30; /* Adjust the alpha value (last parameter) for the desired opacity */
        }
        .btn-smaller {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            margin-left: 5px;
        }   
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
            z-index: 9999; /* Ensure it appears on top of other elements */
            display: none; /* Initially hide the overlay */
        }
        
        .popup-form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .close-btn {
            margin-top: 10px;
        } 
        
        .ratio-card {
          width: 320px;                 
          height: 70px;                
          background-color: #272630;    
          border: 2px solid transparent;
          border-radius: 12px;         
        }
        
        /* Glowing border effects */
        .over-capacity {
          border-color: #dc3545;        
          box-shadow: 0 0 8px #dc3545;   
        }
        
        .under-capacity {
          border-color: rgb(57, 189, 180);        
          box-shadow: 0 0 8px rgb(57, 189, 180);   
        }
        
        /* Text styling */
        .ratio-card .card-title {
          font-size: 1.3rem;     
          color: #ffffff;
          text-align: left!important;   
          margin: 0;
        }
        
        .ratio-card .card-text {
          font-size: 1.55rem;   
          font-weight: bold;
          color: #ffffff;
          text-align: right!important;    
          margin: 0;
        }
        
        /* Mobile dashboard toggle */
        .mobile-dashboard { display: none; }
        .desktop-content { display: block; }

        @media (max-width: 999px) {
          .desktop-content { display: none !important; }
          .mobile-dashboard { display: block; }
        }

        /* Mobile dashboard grid + squares (adapted from index_cacfp) */
        .mobile-dashboard .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 18px;
            width: 100%;
            max-width: 960px;
            margin: 18px auto;
            align-items: center;
            justify-items: center;
            padding: 12px;
        }

        .mobile-dashboard .btn-square {
            width: 100%;
            max-width: 220px;
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px;
            border-radius: 14px;
            color: #ffffff;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: transform .14s ease, box-shadow .14s ease;
            background: rgb(57, 189, 180);
            border: 0;
            box-shadow: 0 10px 26px rgba(0,0,0,0.09);
            overflow: hidden;
            position: relative;
        }

        .mobile-dashboard .btn-square:hover,
        .mobile-dashboard .btn-square:focus {
            transform: translateY(-6px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.14);
            text-decoration: none;
            outline: none;
        }

        .mobile-dashboard .sb-nav-link-icon {
            display: block;
            font-size: 1.6rem;
            line-height: 1;
            margin-bottom: 6px;
            transform-origin: center;
        }
        .mobile-dashboard .sb-nav-link-icon i {
            color: #ffffff;
            font-size: 1.6rem;
            width: 1.9em;
            height: 1.9em;
            display: inline-block;
            text-align: center;
            transform-origin: center;
            transform: translateY(16px) scale(1.6);
            will-change: transform;
            margin-bottom: -0.06em;
        }

        .mobile-dashboard .label {
            display: block;
            padding: 0 8px;
            line-height: 1;
            font-size: 1.25rem;
            color: #ffffff;
            font-weight: 600;
            text-shadow: none;
        }

        @media (min-width: 1200px) {
            .mobile-dashboard .dashboard-grid { gap: 24px; }
            .mobile-dashboard .btn-square { max-width: 220px; }
            .mobile-dashboard .btn-square .label { font-size: 1.35rem; }
        }
        /* Hide subgrids by default (override grid display) */
        .mobile-dashboard .mobile-subgrid,
        .mobile-dashboard .dashboard-grid.mobile-subgrid { display: none; }
</style>
{% endblock %}

{% block content %}
        <!-- Mobile-only squares dashboard -->
        <div class="container-fluid px-4 mobile-dashboard">
            <!-- Main sections grid -->
            <div id="mobileMainGrid" class="dashboard-grid" style="min-height: 40vh;">
                {% if show_sign_in or show_daily_attendance or show_rosters %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('attendance')" aria-label="Attendance">
                    <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
                    <span class="label">Attendance</span>
                </button>
                {% endif %}

                {% if show_inventory or show_weekly_menu or show_milk_inventory or show_meal_count or show_infant_menu %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('food')" aria-label="Food Program">
                    <div class="sb-nav-link-icon"><i class="fas fa-utensils"></i></div>
                    <span class="label">Food Program</span>
                </button>
                {% endif %}

                {% if show_enrollment %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('enrollment')" aria-label="Enrollment">
                    <div class="sb-nav-link-icon"><i class="fas fa-user-graduate"></i></div>
                    <span class="label">Enrollment</span>
                </button>
                {% endif %}

                {% if show_billing or show_payment_setup or show_pay_summary %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('payments')" aria-label="Payments">
                    <div class="sb-nav-link-icon"><i class="fas fa-credit-card"></i></div>
                    <span class="label">Payments</span>
                </button>
                {% endif %}

                {% if show_clock_in or show_orientation %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('employees')" aria-label="Employees">
                    <div class="sb-nav-link-icon"><i class="fas fa-clock"></i></div>
                    <span class="label">Employees</span>
                </button>
                {% endif %}

                {% if show_orientation %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('quality')" aria-label="ABC Quality">
                    <div class="sb-nav-link-icon"><i class="fas fa-clipboard-check"></i></div>
                    <span class="label">ABC Quality</span>
                </button>
                {% endif %}

                {% if show_classroom_options or show_recipes or show_menu_rules or show_permissions or show_payment_setup %}
                <button type="button" class="btn btn-primary btn-square" onclick="openMobileSection('settings')" aria-label="Settings">
                    <div class="sb-nav-link-icon"><i class="fas fa-cogs"></i></div>
                    <span class="label">Settings</span>
                </button>
                {% endif %}
            </div>

            <!-- Attendance sub-grid -->
            {% if show_sign_in or show_daily_attendance or show_rosters %}
            <div id="mobileSection-attendance" class="dashboard-grid mobile-subgrid">
                {% if show_sign_in %}
                <a href="{% url 'sign_in' %}" class="btn btn-primary btn-square" aria-label="Sign In">
                    <div class="sb-nav-link-icon"><i class="fas fa-sign-in-alt"></i></div>
                    <span class="label">Sign In</span>
                </a>
                {% endif %}
                {% if show_daily_attendance %}
                <a href="{% url 'daily_attendance' %}" class="btn btn-primary btn-square" aria-label="Daily Attendance">
                    <div class="sb-nav-link-icon"><i class="fas fa-clipboard-list"></i></div>
                    <span class="label">Daily Attendance</span>
                </a>
                <a href="{% url 'classroom' %}" class="btn btn-primary btn-square" aria-label="Classroom">
                    <div class="sb-nav-link-icon"><i class="fas fa-chalkboard"></i></div>
                    <span class="label">Classroom</span>
                </a>
                {% endif %}
                {% if show_rosters %}
                <a href="{% url 'rosters' %}" class="btn btn-primary btn-square" aria-label="Rosters">
                    <div class="sb-nav-link-icon"><i class="fas fa-users"></i></div>
                    <span class="label">Rosters</span>
                </a>
                {% endif %}
            </div>
            {% endif %}

            <!-- Enrollment sub-grid -->
            {% if show_enrollment %}
            <div id="mobileSection-enrollment" class="dashboard-grid mobile-subgrid">
                <a href="{% url 'enrollment' %}" class="btn btn-primary btn-square" aria-label="Enrollment">
                    <div class="sb-nav-link-icon"><i class="fas fa-user-graduate"></i></div>
                    <span class="label">Enrollment</span>
                </a>
                <a href="{% url 'policies' %}" class="btn btn-primary btn-square" aria-label="Policies">
                    <div class="sb-nav-link-icon"><i class="fas fa-file-alt"></i></div>
                    <span class="label">Policies</span>
                </a>
            </div>
            {% endif %}

            <!-- Food Program sub-grid -->
            {% if show_inventory or show_weekly_menu or show_milk_inventory or show_meal_count or show_infant_menu %}
            <div id="mobileSection-food" class="dashboard-grid mobile-subgrid">
                {% if show_inventory %}
                <a href="{% url 'inventory_list' %}" class="btn btn-primary btn-square" aria-label="Inventory">
                    <div class="sb-nav-link-icon"><i class="fas fa-list"></i></div>
                    <span class="label">Inventory</span>
                </a>
                {% endif %}
                {% if show_weekly_menu %}
                <a href="{% url 'menu' %}" class="btn btn-primary btn-square" aria-label="Weekly Menu">
                    <div class="sb-nav-link-icon"><i class="fas fa-calendar-alt"></i></div>
                    <span class="label">Weekly Menu</span>
                </a>
                {% endif %}
                {% if show_infant_menu %}
                <a href="{% url 'infant_menu' %}" class="btn btn-primary btn-square" aria-label="Infant Menu">
                    <div class="sb-nav-link-icon"><i class="fas fa-baby"></i></div>
                    <span class="label">Infant Menu</span>
                </a>
                {% endif %}
                {% if show_milk_inventory %}
                <a href="{% url 'milk_count' %}" class="btn btn-primary btn-square" aria-label="Milk Inventory">
                    <div class="sb-nav-link-icon"><i class="fas fa-tint"></i></div>
                    <span class="label">Milk Inventory</span>
                </a>
                {% endif %}
                {% if show_meal_count %}
                <a href="{% url 'meal_count' %}" class="btn btn-primary btn-square" aria-label="Meal Count">
                    <div class="sb-nav-link-icon"><i class="fas fa-list-ol"></i></div>
                    <span class="label">Meal Count</span>
                </a>
                {% endif %}
                {% if show_inventory %}
                <a href="{% url 'meal_calculator' %}" class="btn btn-primary btn-square" aria-label="Meal Calculator">
                    <div class="sb-nav-link-icon"><i class="fas fa-calculator"></i></div>
                    <span class="label">Meal Calculator</span>
                </a>
                {% endif %}
            </div>
            {% endif %}

            <!-- Payments sub-grid -->
            {% if show_billing or show_payment_setup or show_pay_summary %}
            <div id="mobileSection-payments" class="dashboard-grid mobile-subgrid">
                {% if show_pay_summary %}
                <a href="{% url 'pay_summary' %}" class="btn btn-primary btn-square" aria-label="Pay Summary">
                    <div class="sb-nav-link-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                    <span class="label">Pay Summary</span>
                </a>
                {% endif %}
                {% if show_billing %}
                <a href="{% url 'payment' %}" class="btn btn-primary btn-square" aria-label="Billing">
                    <div class="sb-nav-link-icon"><i class="fas fa-credit-card"></i></div>
                    <span class="label">Billing</span>
                </a>
                <a href="{% url 'all_pay_history' %}" class="btn btn-primary btn-square" aria-label="Pay History">
                    <div class="sb-nav-link-icon"><i class="fas fa-history"></i></div>
                    <span class="label">Pay History</span>
                </a>
                {% endif %}
            </div>
            {% endif %}

            <!-- Employees sub-grid -->
            {% if show_clock_in or show_orientation %}
            <div id="mobileSection-employees" class="dashboard-grid mobile-subgrid">
                {% if show_clock_in %}
                <a href="{% url 'clock_in' %}" class="btn btn-primary btn-square" aria-label="Time Clock">
                    <div class="sb-nav-link-icon"><i class="fas fa-clock"></i></div>
                    <span class="label">Time Clock</span>
                </a>
                <a href="{% url 'time_sheet' %}" class="btn btn-primary btn-square" aria-label="Time Sheet">
                    <div class="sb-nav-link-icon"><i class="fas fa-file-alt"></i></div>
                    <span class="label">Time Sheet</span>
                </a>
                {% endif %}
                {% if show_orientation %}
                <a href="{% url 'curriculum' %}" class="btn btn-primary btn-square" aria-label="Curriculum">
                    <div class="sb-nav-link-icon"><i class="fas fa-book-open"></i></div>
                    <span class="label">Curriculum</span>
                </a>
                {% endif %}
            </div>
            {% endif %}

            <!-- ABC Quality sub-grid -->
            {% if show_orientation %}
            <div id="mobileSection-quality" class="dashboard-grid mobile-subgrid">
                <a href="{% url 'abc_quality' %}" class="btn btn-primary btn-square" aria-label="ABC Quality">
                    <div class="sb-nav-link-icon"><i class="fas fa-clipboard-check"></i></div>
                    <span class="label">ABC Quality</span>
                </a>
                <a href="{% url 'resources' %}" class="btn btn-primary btn-square" aria-label="Resources">
                    <div class="sb-nav-link-icon"><i class="fas fa-book"></i></div>
                    <span class="label">Resources</span>
                </a>
                <a href="{% url 'staff_orientation' %}" class="btn btn-primary btn-square" aria-label="Orientation">
                    <div class="sb-nav-link-icon"><i class="fas fa-user-check"></i></div>
                    <span class="label">Orientation</span>
                </a>
                <a href="{% url 'score_sheet_list' %}" class="btn btn-primary btn-square" aria-label="Classroom Score">
                    <div class="sb-nav-link-icon"><i class="fas fa-star"></i></div>
                    <span class="label">Classroom Score</span>
                </a>
                <a href="{% url 'surveys_list' %}" class="btn btn-primary btn-square" aria-label="Surveys">
                    <div class="sb-nav-link-icon"><i class="fas fa-poll"></i></div>
                    <span class="label">Surveys</span>
                </a>
            </div>
            {% endif %}

            <!-- Settings sub-grid -->
            {% if show_classroom_options or show_recipes or show_menu_rules or show_permissions or show_payment_setup %}
            <div id="mobileSection-settings" class="dashboard-grid mobile-subgrid">
                {% if show_classroom_options %}
                <a href="{% url 'classroom_options' %}" class="btn btn-primary btn-square" aria-label="Classroom Options">
                    <div class="sb-nav-link-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <span class="label">Classroom Options</span>
                </a>
                {% endif %}
                {% if show_recipes %}
                <a href="{% url 'recipes' %}" class="btn btn-primary btn-square" aria-label="Recipe Options">
                    <div class="sb-nav-link-icon"><i class="fas fa-utensils"></i></div>
                    <span class="label">Recipe Options</span>
                </a>
                {% endif %}
                {% if show_menu_rules %}
                <a href="{% url 'menu_rules' %}" class="btn btn-primary btn-square" aria-label="Menu Rules">
                    <div class="sb-nav-link-icon"><i class="fas fa-list-alt"></i></div>
                    <span class="label">Menu Rules</span>
                </a>
                {% endif %}
                {% if show_permissions %}
                <a href="{% url 'permissions' %}" class="btn btn-primary btn-square" aria-label="Permissions">
                    <div class="sb-nav-link-icon"><i class="fas fa-user-shield"></i></div>
                    <span class="label">Permissions</span>
                </a>
                {% endif %}
                {% if show_payment_setup %}
                <a href="{% url 'square_account' %}" class="btn btn-primary btn-square" aria-label="Payment Set-Up">
                    <div class="sb-nav-link-icon"><i class="fas fa-credit-card"></i></div>
                    <span class="label">Payment Set-Up</span>
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Desktop content (hidden on <1000px) -->
        <div class="desktop-content">
              <h1 class="mt-4">Student Announcements</h1> 
                <div class="container-fluid px-4">
                  <!--  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addAnnouncementModal">
                        <i class="fas fa-plus"></i> Add Student Announcement
                    </button>
                    <div class="mb-3">
                        {% if student_announcements %}
                            <ul class="list-group">
                                {% for announcement in student_announcements %}
                                    <li class="list-group-item">
                                        <strong>{{ announcement.title }}</strong><br>
                                        <span>{{ announcement.message }}</span>
                                        <div class="text-muted" style="font-size: 0.85em;">
                                            Posted: {{ announcement.created_at|date:"M d, Y H:i" }}
                                            {% if announcement.expires_at %}
                                                | Expires: {{ announcement.expires_at|date:"M d, Y H:i" }}
                                            {% endif %}
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="text-muted">No announcements at this time.</div>
                        {% endif %}
                    </div>
                </div>
               
                <h1 class="mt-4">Teacher Announcements</h1>
                <div class="container-fluid px-4">
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addTeacherAnnouncementModal">
                        <i class="fas fa-plus"></i> Add Teacher Announcement
                    </button>
                    <div class="mb-3">
                        {% if teacher_announcements %}
                            <ul class="list-group">
                                {% for announcement in teacher_announcements %}
                                    <li class="list-group-item">
                                        <strong>{{ announcement.title }}</strong><br>
                                        <span>{{ announcement.message }}</span>
                                        <div class="text-muted" style="font-size: 0.85em;">
                                            Posted: {{ announcement.created_at|date:"M d, Y H:i" }}
                                            {% if announcement.expires_at %}
                                                | Expires: {{ announcement.expires_at|date:"M d, Y H:i" }}
                                            {% endif %}
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="text-muted">No announcements at this time.</div>
                        {% endif %}
                    </div>
                </div> -->
<h1 class="mt-4">Ratios</h1>
                    <div class="container-fluid px-4">
                        <div class="d-flex flex-row flex-wrap align-items-center justify-content-start">
                          {% for classroom, data in classroom_cards.items %}
                            <a href="/classroom/?classroom_id={{ data.id }}" style="text-decoration: none;">
                              <div class="card ratio-card mx-2 my-1 {% if data.ratio and data.count > data.ratio %}over-capacity{% else %}under-capacity{% endif %}">
                                <div class="card-body d-flex flex-row justify-content-between align-items-center p-2">
                                  <h6 class="card-title mb-0 text-start">{{ classroom }}</h6>
                                  <p class="card-text mb-0 text-end">
                                    {{ data.count }} / {{ data.ratio|default:"â€“" }}
                                  </p>
                                </div>
                              </div>
                            </a>
                          {% endfor %}
                        </div>
                      </div>
<h1 class="mt-4">Food Program</h1>
                    <div class="container-fluid px-4">
                            <div class="row">
                                <div class="card mb-4 card-out-of-stock bg-faded-red">
                                    <div class="card-header">
                                        <i class="fas fa-ban me-1  text-danger"></i>
                                        <strong class="text-white">Out Of Stock</strong>
                                    </div>
                                    <div class="card-body">
                                        <ul id="outOfStockList" class="list-group">
                                            <!-- Items will be dynamically added here -->
                                        </ul>
                                    </div>
                                </div>
                                <div class="card mb-4 card-out-of-stock bg-faded-yellow">
                                    <div class="card-header">
                                        <i class="fas fa-clock me-1" style="color: #f4e042;"></i>
    
                                        <strong class="text-white">Order Soon</strong>
                                    </div>
                                    <div class="card-body">
                                        <ul id="orderSoonList" class="list-group">
                                            <!-- Items will be dynamically added here -->
                                        </ul>
                                    </div>
                                </div>
                                <div class="card mb-4 card-out-of-stock bg-faded-blue">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <div class="col">
                                            <i class="fas fa-list me-1" style="color: #289783;"></i>
                                            <strong class="text-white">Shopping List</strong>
                                        </div>
                                        <div class="col-auto">
                                            <button id="shoppingListButton" type="button" class="btn btn-light btn-sm btn-smaller" onclick="toggleOrderForm()"><i class="fas fa-plus"></i></button>
                                        </div>
                                        <button id="dropdownButton" type="button" class="btn btn-light btn-sm btn-smaller" onclick="toggleDropdown()">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                        
                                    </div>
                                    
                                    <div class="card-body">
                                        <!-- Display the list of items -->
                                        <ul id="shoppingList" class="list-group">
                                            {% for item in order_items %}
                                                <li class="list-group-item list-group-item-action">
                                                    {{ item.item }} 
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    <div id="dropdownFormOverlay" class="popup-overlay" style="display: none;">
                                        <div class="popup-form">
                                            <h2>Delete Shopping Items</h2>
                                            <form id="deleteItemsForm" method="post" action="{% url 'delete_shopping_items' %}">
                                                {% csrf_token %}
                                                <div class="form-check">
                                                    {% for item in order_items %}
                                                    <input class="form-check-input" type="checkbox" id="item{{ item.id }}" name="items[]" value="{{ item.id }}">
                                                    <label class="form-check-label" for="item{{ item.id }}">
                                                        {{ item.item }}
                                                    </label><br>
                                                    {% endfor %}
                                                </div>
                                                <button type="submit" class="btn btn-warning btn-sm">Delete Selected</button>
                                                <button type="button" class="btn btn-danger close-btn" onclick="closeDropdownForm()">Close</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="card mb-4 card-out-of-stock bg-faded-green">
                                    <div class="card-header">
                                        <i class="fas fa-check me-1" style="color: #32b69e;"></i>
                                        <strong class="text-white">Ordered</strong>
                                    
                                        <button id="toggleEditFormButton" class="btn btn-light btn-sm btn-smaller" onclick="toggleEditForm()"><i class="fas fa-edit"></i></button>
                                    </div>
                                    
                                    <div class="card-body">
                                      
                                        <ul id="shoppingList" class="list-group">
                                            {% for item in order_items %}
                                                {% if item.ordered %}
                                                    <li class="list-group-item list-group-item-action">{{ item.item }}</li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                            </div>
                        </div>
                    </main>
                    <div id="orderFormOverlay" class="popup-overlay">
                        <div class="popup-form">
                            <h2>Add to Shopping List</h2>
                            <form action="{% url 'order_list' %}" method="post">
                                {% csrf_token %}
                                <!-- Item input field -->
                                <div class="form-group mb-3">
                                    <label for="item">Item:</label>
                                    <input type="text" id="item" name="item" class="form-control">
                                </div>
                                <!-- Quantity input field -->
                                <div class="form-group mb-3">
                                    <label for="quantity">Quantity:</label>
                                    <input type="number" id="quantity" name="quantity" class="form-control" value="1">
                                </div>
                                <button type="submit" class="btn btn-primary me-2">Add to Shopping List</button>
                                <button type="button" class="btn btn-danger close-btn" onclick="closeOrderForm()">Close</button>
                            </form>
                        </div>
                    </div>
                    <div id="editFormOverlay" class="popup-overlay">
                        <div class="popup-form">
                            <h2>Items Ordered</h2>
                            <form id="editShoppingListForm" method="post" action="{% url 'update_orders' %}">
                                {% csrf_token %}
                                <div class="form-group">
                                    {% for item in order_items %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="item{{ item.id }}" name="items" value="{{ item.id }}">
                                            <label class="form-check-label" for="item{{ item.id }}">
                                                {{ item.item }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                <button type="button" class="btn btn-danger close-btn" onclick="closeEditForm()">Close</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Add Announcement Modal -->
<div class="modal fade" id="addAnnouncementModal" tabindex="-1" aria-labelledby="addAnnouncementModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'add_announcement' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addAnnouncementModalLabel">Add Student Announcement</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="announcementTitle" class="form-label">Title</label>
            <input type="text" class="form-control" id="announcementTitle" name="title" required>
          </div>
          <div class="mb-3">
            <label for="announcementMessage" class="form-label">Message</label>
            <textarea class="form-control" id="announcementMessage" name="message" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label for="announcementExpiresAt" class="form-label">Expires At</label>
            <input type="datetime-local" class="form-control" id="announcementExpiresAt" name="expires_at" required>
          </div>
          <!-- Hidden field to specify recipient type -->
          <input type="hidden" name="recipient_type" value="student">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Teacher Announcement Modal -->
<div class="modal fade" id="addTeacherAnnouncementModal" tabindex="-1" aria-labelledby="addTeacherAnnouncementModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'add_announcement' %}" id="teacherAnnouncementForm">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addTeacherAnnouncementModalLabel">Add Teacher Announcement</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="teacherAnnouncementTitle" class="form-label">Title</label>
            <input type="text" class="form-control" id="teacherAnnouncementTitle" name="title" required>
          </div>
          <div class="mb-3">
            <label for="teacherAnnouncementMessage" class="form-label">Message</label>
            <textarea class="form-control" id="teacherAnnouncementMessage" name="message" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label for="teacherAnnouncementExpiresAt" class="form-label">Expires At</label>
            <input type="datetime-local" class="form-control" id="teacherAnnouncementExpiresAt" name="expires_at" required>
          </div>
          <!-- Hidden field to specify recipient type -->
          <input type="hidden" name="recipient_type" value="teacher">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
{% block scripts %}
<script>
    // Mobile sections navigation (show sub-grid, hide main)
    (function() {
        window.openMobileSection = function(name) {
            var main = document.getElementById('mobileMainGrid');
            if (main) main.style.display = 'none';
            document.querySelectorAll('.mobile-subgrid').forEach(function(el){ el.style.display = 'none'; });
            var target = document.getElementById('mobileSection-' + name);
            if (target) target.style.display = 'grid';
        };
        window.closeMobileSection = function() {
            document.querySelectorAll('.mobile-subgrid').forEach(function(el){ el.style.display = 'none'; });
            var main = document.getElementById('mobileMainGrid');
            if (main) main.style.display = 'grid';
        };
        // Ensure initial state shows only main grid on load
        document.addEventListener('DOMContentLoaded', function(){
            // Only applies to mobile view; harmless otherwise
            window.closeMobileSection();
        });
    })();

            // Wait for the document to be ready
            $(document).ready(function() {
                // Function to fetch and display out-of-stock items
                function fetchOutOfStockItems() {
                    // Make an AJAX request to your backend endpoint
                    $.ajax({
                        url: '/api/out-of-stock-items', // Replace this with your actual backend endpoint URL
                        method: 'GET',
                        success: function(response) {
                            // Clear the existing list items
                            $('#outOfStockList').empty();
    
                            // Loop through the response data and append each item to the list
                            response.forEach(function(item) {
                                $('#outOfStockList').append('<li class="list-group-item">' + item.name + '</li>');
                            });
                        },
                        error: function(xhr, status, error) {
                            // Handle errors
                            console.error('Error fetching out-of-stock items:', error);
                        }
                    });
                }
    
                // Function to fetch and display items for orders soon
                function fetchOrderSoonItems() {
                    // Make an AJAX request to your backend endpoint
                    $.ajax({
                        url: '/api/order-soon-items', // Replace this with your actual backend endpoint URL for items for orders soon
                        method: 'GET',
                        success: function(response) {
                            // Clear the existing list items
                            $('#orderSoonList').empty();
    
                            // Loop through the response data and append each item to the list
                            response.forEach(function(item) {
                                $('#orderSoonList').append('<li class="list-group-item">' + item.name + '</li>');
                            });
                        },
                        error: function(xhr, status, error) {
                            // Handle errors
                            console.error('Error fetching items for orders soon:', error);
                        }
                    });
                }
    
                // Function to fetch and display shopping list items
                function fetchShoppingListItems() {
                    // Make an AJAX request to your backend endpoint
                    $.ajax({
                        url: '/api/shopping-list', // Replace this with the actual URL of your backend endpoint
                        method: 'GET',
                        success: function(response) {
                            // Clear the existing list items
                            $('#shoppingList').empty();
    
                            // Loop through the response data and append each item to the list
                            response.forEach(function(item) {
                                $('#shoppingList').append('<li class="list-group-item list-group-item-action">' + item.name + '</li>');
                            });
                        },
                        error: function(xhr, status, error) {
                            // Handle errors
                            console.error('Error fetching shopping list items:', error);
                        }
                    });
                }
    
                // Call the fetchOutOfStockItems function to initially fetch and display out-of-stock items
                fetchOutOfStockItems();
    
                // Call the fetchOrderSoonItems function to initially fetch and display items for orders soon
                fetchOrderSoonItems();
    
                // Call the fetchShoppingListItems function to initially fetch and display shopping list items
                fetchShoppingListItems();
            });
    
        $(document).ready(function() {
            // Hide the order form overlay initially
            $("#orderFormOverlay").hide();
    
            // Function to toggle the display of the popup form
            window.toggleOrderForm = function() {
                $("#orderFormOverlay").toggle();
            };
    
            // Function to close the order form
            window.closeOrderForm = function() {
                $("#orderFormOverlay").hide();
            };
        });
       
    
        $(document).ready(function() {
        $('#editShoppingListForm').submit(function(event) {
            event.preventDefault(); // Prevent the default form submission
    
            // Serialize the form data
            var formData = $(this).serialize();
    
            // Send an AJAX request to update the orders
            $.ajax({
                url: $(this).attr('action'),
                type: $(this).attr('method'),
                data: formData,
                success: function(response) {
                    // Display a success message
                    $('#editFormOverlay').hide(); // Hide the edit form overlay
                    // You can customize this message display according to your UI
                    
                    // Reload the page after successful submission
                    location.reload();
                },
                error: function(xhr, status, error) {
                    // Display an error message if the request fails
                    // You can customize this message display according to your UI
                    alert('Error updating orders');
                }
            });
        });
    });
    $(document).ready(function() {
        // Hide the edit form overlay initially
        $("#editFormOverlay").hide();
    
        // Function to toggle the display of the popup form
        window.toggleEditForm = function() {
            $("#editFormOverlay").toggle();
        };
    
        // Function to close the edit form
        window.closeEditForm = function() {
            $("#editFormOverlay").hide();
        };
    });
    
        $(document).ready(function() {
            $('#editShoppingListForm').submit(function(event) {
                event.preventDefault(); // Prevent the default form submission
    
                // Serialize the form data
                var formData = $(this).serialize();
    
                // Send an AJAX request to update the orders
                $.ajax({
                    url: $(this).attr('action'),
                    type: $(this).attr('method'),
                    data: formData,
                    success: function(response) {
                        // Display a success message
                        $('#editFormOverlay').hide(); // Hide the edit form overlay
                        // You can customize this message display according to your UI
                        alert('Orders updated successfully');
                    },
                    error: function(xhr, status, error) {
                        // Display an error message if the request fails
                        // You can customize this message display according to your UI
                        alert('Error updating orders');
                    }
                });
            });
        });
        
        $(document).ready(function() {
        // Function to toggle the display of the dropdown form popup
        window.toggleDropdownForm = function() {
            $("#dropdownFormOverlay").toggle();
        };
    
        // Function to close the dropdown form popup
        window.closeDropdownForm = function() {
            $("#dropdownFormOverlay").hide();
        };
    
        // Function to toggle the dropdown form when the button is clicked
        $("#dropdownButton").click(function() {
            toggleDropdownForm();
        });
    });
    $(document).ready(function() {
        // Hide the order form overlay initially
        $("#orderFormOverlay").hide();
    
        // Function to toggle the display of the popup form
        window.toggleOrderForm = function() {
            $("#orderFormOverlay").toggle();
        };
    
        // Function to close the order form
        window.closeOrderForm = function() {
            $("#orderFormOverlay").hide();
        };
    
        // Function to handle form submission and clean input
        $("form").on("submit", function(e) {
            // Get the input fields for item and quantity
            var itemInput = $("#item");
            var quantityInput = $("#quantity");
    
            // Clean the item input: capitalize the first letter of each word
            var cleanedItem = itemInput.val().trim().toLowerCase().replace(/\b\w/g, function(match) {
                return match.toUpperCase();
            });
            itemInput.val(cleanedItem); // Set the cleaned value back to the input
    
            // Optionally, you can add more validation here, e.g., ensuring quantity is valid
    
            // Allow the form to be submitted
        });
    });
    $(document).ready(function() {
    $('#addAnnouncementModal form').submit(function(event) {
        event.preventDefault();
        var $form = $(this);
        var formData = $form.serialize();
        $.ajax({
            url: $form.attr('action'),
            type: 'POST',
            data: formData,
            success: function(response) {
                // Hide the modal
                $('#addAnnouncementModal').modal('hide');
                // Optionally, clear the form fields
                $form[0].reset();
                // Reload the page to show the new announcement
                location.reload();
            },
            error: function(xhr) {
                alert('Error adding announcement.');
            }
        });
    });
    
});
$(document).ready(function() {
    $('#teacherAnnouncementForm').submit(function(event) {
        event.preventDefault();
        var $form = $(this);
        var expiresAt = $('#teacherAnnouncementExpiresAt').val();
        if (!expiresAt) {
            alert('Expiration date and time is required.');
            return false;
        }
        var formData = $form.serialize();
        $.ajax({
            url: $form.attr('action'),
            type: 'POST',
            data: formData,
            success: function(response) {
                $('#addTeacherAnnouncementModal').modal('hide');
                $form[0].reset();
                location.reload();
            },
            error: function(xhr) {
                alert('Error adding teacher announcement.');
            }
        });
    });
});
    </script>
   {% endblock %}
