{% extends 'tottimeapp/base.html' %}
{% load static %} 
{% load custom_filters %}
{% load dict_extras %}
{% block title %}Weekly Menu{% endblock %}

{% block styles %}
<style>
/* Remove bold font weight from specific rows by targeting their IDs */
#grainRow th,
#meatRow th {
    font-weight: normal;
}
#weeklyMenuHeader {
    background-color: #272630;
    color: #ffffff;
    text-align: center;
}
      
.table input[type="text"] {
    border: 1px solid #ced4da; /* Add border */
    border-radius: .25rem; /* Add border-radius */
    padding: .375rem .75rem; /* Add padding */
    width: 100%; /* Ensure the input field takes up the entire width of the cell */
}

/* Style for editable cells */
.input-box {
    height: auto; /* Adjust height */
}

/* Style for the table */
.table {
    border-collapse: collapse; /* Collapse the borders of the table */
    width: 100%; /* Make the table take up the entire width */
    table-layout: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 10px; /* Add this for rounded corners */
    overflow: hidden;
}

h1 {
    margin-top: 0;
    margin-bottom: -35px;
    margin-left: 27px;
    font-weight: bold;
    line-height: 1.2;
    font-size: 40px;
}

.button-container {
    margin-right: 10px; /* Adjust the margin as needed */
}


/* Custom button styles */
.btn-primary {
    background-color: rgb(228, 218, 79); /* Change primary button color */
    border-color: rgb(228, 218, 79);
    color:rgb(33, 31, 39);
    font-weight: 555;
    
}

.btn-success {
    background-color: rgb(57, 189, 180); /* Change success button color */
    border-color: rgb(57, 189, 180);
    color:rgb(33, 31, 39);
    font-weight: 555;
}

/* Additional hover styles (optional) */
.btn-primary:hover {
    background-color: #b4ad46;
    border-color: #b4ad46;
}

.btn-success:hover {
    background-color: #007b8a;
    border-color: #007b8a;
}


th, td {
    border: 1px solid #dee2e6; /* Add border */
    padding: .75rem; /* Add padding */
    word-wrap: break-word;
    
}

/* Style for table header and body */
.table thead th,
.table tbody td {
    text-align: left; /* Align text to the left */
    font-weight: normal;
    
}
.table thead th,
.table tbody tr:nth-child(-n+3) {
    font-weight: bold;
    
    
}

/* Style for the table title */
.table-title {
    border: 1px solid #dee2e6; /* Add border */
    padding: .75rem; /* Add padding */
    text-align: center; /* Align text to the center */
}

.vertical-header {
    writing-mode: vertical-rl; /* Set text to vertical writing mode */
    transform: rotate(180deg); /* Rotate the text 180 degrees */
    white-space: nowrap; /* Prevent text from wrapping */
   
}


    @media print {
    h1,
    .sb-topnav,
    .sb-sidenav-footer,
    .button-container,
    #generateMenuBtn,
    #saveMenuBtn {
        display: none;
    }
    .vertical-header {
        writing-mode: horizontal-tb; /* Set text to horizontal writing mode when printing */
        transform: none; /* Remove rotation for horizontal text */
    }
    .table thead th,
    .table tbody td {
            word-wrap: break-word !important;
            white-space: normal !important;
            border: 1px solid #dee2e6; /* Add border */
            padding: .5rem; /* Adjust padding for printing */
            font-size: 0.8rem; /* Adjust font size for printing */
        }
    .table {
        table-layout: fixed;
        width: 200%;
    }
    .table tbody td:first-child {
        width: 20px; /* Replace 100px with the width of your first column */
    }
    @page {
        margin-top: -90px;
    }
    body {
        margin: 0;
        width: fit-content;
    }
}
.sb-nav-link-icon i {
    color: rgb(57, 189, 180);
    font-size: 1.2rem; /* Icon size */
    vertical-align: middle; /* Adjust vertical alignment */
    line-height: 1; /* Prevent icon from being too high */
    
}
/* Style for the link text */
.nav-link {
    color: #ffffff !important; /* Ensure text is completely white */
}

/* Style for the arrow after the link */
.sb-sidenav-collapse-arrow i {
    color: rgb(228, 218, 79);
}

/* Optional: Hover effect for nav links */
.nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1); /* Slight background change on hover */
    color: #ffffff !important; /* Retain white text on hover */
}
.navbar-brand img {
    width: 100%; /* Ensure the logo takes up the full width of its container */
    max-width: 200px; /* Set a max-width to control the size of the logo */
    height: auto; /* Maintain aspect ratio */
    object-fit: contain; /* Make sure the logo doesn't get distorted */
    margin-left: 0; /* Reset any left margin if needed */
    border-radius: 0; /* Remove any border-radius if it's causing a vignette effect */
    overflow: visible; /* Ensure no clipping occurs */
}
.btn-rec {
background-color: rgb(153, 158, 158); /* Change success button color */
border-color: rgb(153, 158, 158);
color: rgb(33, 31, 39);
font-size: 17px;
font-weight: 550;
padding: 4px 6px !important; /* Add padding for more space */

}

/* Additional hover styles (optional) */
.btn-rec:hover {
color: rgb(255, 255, 255);
background-color: rgb(54, 56, 56);
border-color: rgb(54, 56, 56);
}
</style>
{% endblock %}

{% block content %}
                <h1 class="mt-4">Weekly Menu</h1>
        <div class="container mt-5" id="printableTable">
            <form onsubmit="event.preventDefault(); checkMenuExistsAndSave();" id="menuForm"> <!-- Start of the form -->
                <div class="row">
                    <div class="col">
                        <div class="mb-3">
                            <button id="generateMenuBtn" class="btn btn-primary mr-2">Generate Menu</button>
                            <button id="saveMenuBtn" type="submit" class="btn btn-success">Save Menu</button> <!-- Button type set to submit -->
                            <a href="{% url 'past_menus' %}" class="btn btn-rec" style="margin-left: 15px;">
                                Saved Weekly Menus
                            </a>    
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col">
                        <table id="weeklyMenuTable" class="table">
                            <thead>
                        <tr>
                            <th id="weeklyMenuHeader" scope="col" colspan="7" style="text-align: center;">Weekly Menu: Date - Date</th>
                        </tr>
                        <tr>
                            <th scope="col" colspan="2">Facility:</th>
                            <th scope="col" style="text-align: center;">Monday</th>
                            <th scope="col" style="text-align: center;">Tuesday</th>
                            <th scope="col" style="text-align: center;">Wednesday</th>
                            <th scope="col" style="text-align: center;">Thursday</th>
                            <th scope="col" style="text-align: center;">Friday</th>
                        </tr>
                        <tr>
                            <th scope="col" colspan="2">Sponsor:</th>
                            <th scope="col" style="text-align: center;"><span class="weekday-date"></span></th>
                            <th scope="col" style="text-align: center;"><span class="weekday-date"></span></th>
                            <th scope="col" style="text-align: center;"><span class="weekday-date"></span></th>
                            <th scope="col" style="text-align: center;"><span class="weekday-date"></span></th>
                            <th scope="col" style="text-align: center;"><span class="weekday-date"></span></th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="vertical-header" rowspan="4" style="font-weight: bold; text-align: center;">Breakfast</td>
                            <td>Fluid Milk</td>
                            <td id="mondayMilk"style="text-align: center;"></td>
                            <td id="tuesdayMilk"style="text-align: center;"></td>
                            <td id="wednesdayMilk"style="text-align: center;"></td>
                            <td id="thursdayMilk"style="text-align: center;"></td>
                            <td id="fridayMilk"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Fruit, Vegetable, or Full Strength Juice</td>
                            <td id="mondayfruit"style="text-align: center;"></td>
                            <td id="tuesdayfruit"style="text-align: center;"></td>
                            <td id="wednesdayfruit"style="text-align: center;"></td>
                            <td id="thursdayfruit"style="text-align: center;"></td>
                            <td id="fridayfruit"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Bread or Bread Alternate(s)</td>
                            <td id="mondaybread"style="text-align: center;"></td>
                            <td id="tuesdaybread"style="text-align: center;"></td>
                            <td id="wednesdaybread"style="text-align: center;"></td>
                            <td id="thursdaybread"style="text-align: center;"></td>
                            <td id="fridaybread"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Additional Food (Optional)</td>
                            <td id="mondayadd1"style="text-align: center;"></td>
                            <td id="tuesdayadd1"style="text-align: center;"></td>
                            <td id="wednesdayadd1"style="text-align: center;"></td>
                            <td id="thursdayadd1"style="text-align: center;"></td>
                            <td id="fridayadd1"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td class="vertical-header" rowspan="4" style="font-weight: bold; text-align: center;">AM Snack</td>
                            <td>Choose 2 of these 5: Fluid Milk</td>
                            <td id="mondaychoose1"style="text-align: center;"></td>
                            <td id="tuesdaychoose1"style="text-align: center;"></td>
                            <td id="wednesdaychoose1"style="text-align: center;"></td>
                            <td id="thursdaychoose1"style="text-align: center;"></td>
                            <td id="fridaychoose1"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Fruit, Vegetable, or Full Strength Juice</td>
                            <td id="mondayfruit2"style="text-align: center;"></td>
                            <td id="tuesdayfruit2"style="text-align: center;"></td>
                            <td id="wednesdayfruit2"style="text-align: center;"></td>
                            <td id="thursdayfruit2"style="text-align: center;"></td>
                            <td id="fridayfruit2"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Bread or Bread Alternate(s)</td>
                            <td id="mondaybread2"style="text-align: center;"></td>
                            <td id="tuesdaybread2"style="text-align: center;"></td>
                            <td id="wednesdaybread2"style="text-align: center;"></td>
                            <td id="thursdaybread2"style="text-align: center;"></td>
                            <td id="fridaybread2"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Meat or Meat Alternate</td>
                            <td id="mondaymeat1"style="text-align: center;"></td>
                            <td id="tuesdaymeat1"style="text-align: center;"></td>
                            <td id="wednesdaymeat1"style="text-align: center;"></td>
                            <td id="thursdaymeat1"style="text-align: center;"></td>
                            <td id="fridaymeat1"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td class="vertical-header" rowspan="7" style="font-weight: bold; text-align: center;">Lunch</td>
                            <td>Main Dish</td>
                            <td id="mondayMeals"style="text-align: center;"></td>
                            <td id="tuesdayMeals"style="text-align: center;"></td>
                            <td id="wednesdayMeals"style="text-align: center;"></td>
                            <td id="thursdayMeals"style="text-align: center;"></td>
                            <td id="fridayMeals"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Fluid Milk</td>
                            <td id="mondayLunchMilk"style="text-align: center;"></td>
                            <td id="tuesdayLunchMilk"style="text-align: center;"></td>
                            <td id="wednesdayLunchMilk"style="text-align: center;"></td>
                            <td id="thursdayLunchMilk"style="text-align: center;"></td>
                            <td id="fridayLunchMilk"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Vegetable</td>
                            <td id="mondayvege"style="text-align: center;"></td>
                            <td id="tuesdayvege"style="text-align: center;"></td>
                            <td id="wednesdayvege"style="text-align: center;"></td>
                            <td id="thursdayvege"style="text-align: center;"></td>
                            <td id="fridayvege"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Fruit</td>
                            <td id="mondayfruit3"style="text-align: center;"></td>
                            <td id="tuesdayfruit3"style="text-align: center;"></td>
                            <td id="wednesdayfruit3"style="text-align: center;"></td>
                            <td id="thursdayfruit3"style="text-align: center;"></td>
                            <td id="fridayfruit3"style="text-align: center;"></td>
                        </tr>
                        <tr id="grainRow">
                            <th scope="col">Grain</th>
                            <th id="mondayGrain"style="text-align: center;"></th>
                            <th id="tuesdayGrain"style="text-align: center;"></th>
                            <th id="wednesdayGrain"style="text-align: center;"></th>
                            <th id="thursdayGrain"style="text-align: center;"></th>
                            <th id="fridayGrain"style="text-align: center;"></th>
                        </tr>
                        <tr id="meatRow">
                            <th scope="col">Meat or Meat Alternate</th>
                            <th id="mondayMeatAlternate"style="text-align: center;"></th>
                            <th id="tuesdayMeatAlternate"style="text-align: center;"></th>
                            <th id="wednesdayMeatAlternate"style="text-align: center;"></th>
                            <th id="thursdayMeatAlternate"style="text-align: center;"></th>
                            <th id="fridayMeatAlternate"style="text-align: center;"></th>
                        </tr>
                        <tr>
                            <td>Additional Food (Optional)</td>
                            <td id="mondayadd2"style="text-align: center;"></td>
                            <td id="tuesdayadd2"style="text-align: center;"></td>
                            <td id="wednesdayadd2"style="text-align: center;"></td>
                            <td id="thursdayadd2"style="text-align: center;"></td>
                            <td id="fridayadd2"style="text-align: center;"></td>
                        </tr>
                        <tr> 
                            <td class="vertical-header" rowspan="4" style="font-weight: bold; text-align: center;">PM Snack</td>
                            <td>Choose 2 of these 5: Fluid Milk</td>
                            <td id="mondaychoose2"style="text-align: center;"></td>
                            <td id="tuesdaychoose2"style="text-align: center;"></td>
                            <td id="wednesdaychoose2"style="text-align: center;"></td>
                            <td id="thursdaychoose2"style="text-align: center;"></td>
                            <td id="fridaychoose2"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Fruit, Vegetable, or Full Strength Juice</td>
                            <td id="mondayfruit4"style="text-align: center;"></td>
                            <td id="tuesdayfruit4"style="text-align: center;"></td>
                            <td id="wednesdayfruit4"style="text-align: center;"></td>
                            <td id="thursdayfruit4"style="text-align: center;"></td>
                            <td id="fridayfruit4"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Bread or Bread Alternate(s)</td>
                            <td id="mondaybread3"style="text-align: center;"></td>
                            <td id="tuesdaybread3"style="text-align: center;"></td>
                            <td id="wednesdaybread3"style="text-align: center;"></td>
                            <td id="thursdaybread3"style="text-align: center;"></td>
                            <td id="fridaybread3"style="text-align: center;"></td>
                        </tr>
                        <tr>
                            <td>Meat or Meat Alternate</td>
                            <td id="mondaymeat3"style="text-align: center;"></td>
                            <td id="tuesdaymeat3"style="text-align: center;"></td>
                            <td id="wednesdaymeat3"style="text-align: center;"></td>
                            <td id="thursdaymeat3"style="text-align: center;"></td>
                            <td id="fridaymeat3"style="text-align: center;"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endblock %}
    {% block scripts %}
    <script>
    $(document).ready(function() {
     // Handle Generate Menu button click event
     $('#generateMenuBtn').click(function() {
         // AJAX request to generate main menu
         $.ajax({
             url: '/generate_menu/',  // URL for generating main menu
             type: 'POST',
             data: {},  // Data needed for the backend operation
             beforeSend: function(xhr, settings) {
                 // Include CSRF token in request headers
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             },
             success: function(response) {
                 updateTable(response); 
                 
             },
             error: function(xhr, status, error) {
                 console.error('Error:', error);
                 // Handle error if necessary
             }
         });
 
         // AJAX request to generate AM menu
         $.ajax({
             url: '/generate_am_menu/',  // URL for generating AM menu
             type: 'POST',
             data: {},  // Data needed for the backend operation (if any)
             beforeSend: function(xhr, settings) {
                 // Include CSRF token in request headers
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             },
             success: function(response) {
                 // Handle the successful response from the server
                 // Update the AM table with the received data
                 updateAMTable(response); 
             },
             error: function(xhr, status, error) {
                 // Handle errors that occur during the AJAX request
                 console.error('Error:', error);
             }
         });
 
         // AJAX request to update fruit table 1
         $.ajax({
             url: '/generate_fruit_menu/',  // URL for generating fruit menu
             type: 'POST',
             data: {},  // Data needed for the backend operation (if any)
             beforeSend: function(xhr, settings) {
                 // Include CSRF token in request headers
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             },
             success: function(response) {
                 // Handle the successful response from the server
                 // Update the fruit table with the received data
                 updateFruitTable(response); 
             },
             error: function(xhr, status, error) {
                 // Handle errors that occur during the AJAX request
                 console.error('Error:', error);
             }
         });
 
 // AJAX request to update vegetable table
 $.ajax({
     url: '/generate_vegetable_menu/',  // URL for generating vegetable menu
     type: 'POST',
     data: {},  // Data needed for the backend operation (if any)
     beforeSend: function(xhr, settings) {
         // Include CSRF token in request headers
         xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
     },
     success: function(response) {
         // Handle the successful response from the server
         // Log the received data
         console.log('Vegetable Menu Data:', response);
         
         // Update the vegetable table with the received data
         updateVegetableTable(response); 
     },
     error: function(xhr, status, error) {
         // Handle errors that occur during the AJAX request
         console.error('Error:', error);
     }
 });
 
         // AJAX request to generate PM menu
         $.ajax({
             url: '/generate_pm_menu/',  // URL for generating PM menu
             type: 'POST',
             data: {},  // Data needed for the backend operation
             beforeSend: function(xhr, settings) {
                 // Include CSRF token in request headers
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             },
             success: function(response) {
                 updatePMTable(response); 
            
             },
             error: function(xhr, status, error) {
                 console.error('Error:', error);
             }
         });
 
         // AJAX request to generate breakfast menu
         $.ajax({
             url: '/generate_breakfast_menu/',  // URL for generating breakfast menu
             type: 'POST',
             data: {},  // Data needed for the backend operation
             beforeSend: function(xhr, settings) {
                 // Include CSRF token in request headers
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             },
             success: function(response) {
                 // Update the breakfast table
                 updateBreakfastTable(response); 
                 updateDates();
             },
             error: function(xhr, status, error) {
                 console.error('Error:', error);
             }
         });
     });
     function updateBerries(response) {
    // List of berries to check
    var berries = ['Strawberries', 'Blackberries', 'Blueberries'];
    // Flag to track if any berry is present
    var isBerryPresent = false;
    
    // Check for berries in the Wednesday, Thursday, and Friday cells
    var cellTexts = [
        $('#mondayfruit').text().toLowerCase(),
        $('#tuesdayfruit').text().toLowerCase(),
        $('#wednesdayfruit').text().toLowerCase(),
        $('#thursdayfruit').text().toLowerCase(),
        $('#fridayfruit').text().toLowerCase(),

        $('#mondayfruit2').text().toLowerCase(),
        $('#tuesdayfruit2').text().toLowerCase(),
        $('#wednesdayfruit2').text().toLowerCase(),
        $('#thursdayfruit2').text().toLowerCase(),
        $('#fridayfruit2').text().toLowerCase(),

        $('#mondayfruit3').text().toLowerCase(),
        $('#tuesdayfruit3').text().toLowerCase(),
        $('#wednesdayfruit3').text().toLowerCase(),
        $('#thursdayfruit3').text().toLowerCase(),
        $('#fridayfruit3').text().toLowerCase(),

        $('#mondayfruit4').text().toLowerCase(),
        $('#tuesdayfruit4').text().toLowerCase(),
        $('#wednesdayfruit4').text().toLowerCase(),
        $('#thursdayfruit4').text().toLowerCase(),
        $('#fridayfruit4').text().toLowerCase(),
    ];

    cellTexts.forEach(function(cellText) {
        berries.forEach(function(berry) {
            if (cellText.includes(berry.toLowerCase())) {
                isBerryPresent = true;
                return false; // Exit the loop since we found a match
            }
        });
    });
    // If no berries are present, replace with a random berry
    if (!isBerryPresent) {
        // Randomly select a berry from the list
        var randomBerry = berries[Math.floor(Math.random() * berries.length)];
        // Update the Friday cell with the randomly selected berry
        $('#fridayfruit').text(randomBerry);
    }
}

function updateLeafyGreen(response) {
    var leafygreen = ['Salad (Red Leaf, Green Leaf, Arugula, Chervil)'];
    var checks = ['Salad (Red Leaf, Green Leaf, Arugula, Chervil)','Yams', 'Carrots','Baked Beans'];
    var isleafygreenPresent = false;
    var cellTexts = [
        $('#mondayfruit').text().toLowerCase(),
        $('#tuesdayfruit').text().toLowerCase(),
        $('#wednesdayfruit').text().toLowerCase(),
        $('#thursdayfruit').text().toLowerCase(),
        $('#fridayfruit').text().toLowerCase(),

        $('#mondayfruit2').text().toLowerCase(),
        $('#tuesdayfruit2').text().toLowerCase(),
        $('#wednesdayfruit2').text().toLowerCase(),
        $('#thursdayfruit2').text().toLowerCase(),
        $('#fridayfruit2').text().toLowerCase(),

        $('#mondayvege').text().toLowerCase(),
        $('#tuesdayvege').text().toLowerCase(),
        $('#wednesdayvege').text().toLowerCase(),
        $('#thursdayvege').text().toLowerCase(),
        $('#fridayvege').text().toLowerCase(),

        $('#mondayfruit4').text().toLowerCase(),
        $('#tuesdayfruit4').text().toLowerCase(),
        $('#wednesdayfruit4').text().toLowerCase(),
        $('#thursdayfruit4').text().toLowerCase(),
        $('#fridayfruit4').text().toLowerCase(),
    ];

    cellTexts.forEach(function(cellText) {
        leafygreen.forEach(function(green) {
            if (cellText.includes(green.toLowerCase())) {
                isleafygreenPresent = true;
                return false; // Exit the loop since we found a match
            }
        });
    });
   
    if (!isleafygreenPresent) {
        var cellIDs = [
        'mondayvege', 'tuesdayvege', 'wednesdayvege', 'thursdayvege', 'fridayvege',
    ];

    // Loop through each cell ID
    for (var i = 0; i < cellIDs.length; i++) {
        var cellText = $('#' + cellIDs[i]).text().trim().toLowerCase();
        
        // Check if the cell text contains any of the items in checks
        var containsCheck = checks.some(function(check) {
            return cellText.includes(check.toLowerCase());
        });

        // If none of the checks are present in the cell text, update the cell
        if (!containsCheck) {
            // Randomly select a leafy green item from the list
            var randomGreen = leafygreen[Math.floor(Math.random() * leafygreen.length)];
            // Update the cell with the randomly selected leafy green item
            $('#' + cellIDs[i]).text(randomGreen);
            // Exit the loop after updating the cell
            return;
        }
    }
}
}

function updateYellowVeg(response) {
    var yellowveg = ['Yams', 'Carrots'];
    var checks = ['Salad (Red Leaf, Green Leaf, Arugula, Chervil)','Yams', 'Carrots','Baked Beans'];
    var isYellowVegPresent = false;
    var cellTexts = [
        $('#mondayfruit').text().toLowerCase(),
        $('#tuesdayfruit').text().toLowerCase(),
        $('#wednesdayfruit').text().toLowerCase(),
        $('#thursdayfruit').text().toLowerCase(),
        $('#fridayfruit').text().toLowerCase(),

        $('#mondayfruit2').text().toLowerCase(),
        $('#tuesdayfruit2').text().toLowerCase(),
        $('#wednesdayfruit2').text().toLowerCase(),
        $('#thursdayfruit2').text().toLowerCase(),
        $('#fridayfruit2').text().toLowerCase(),

        $('#mondayvege').text().toLowerCase(),
        $('#tuesdayvege').text().toLowerCase(),
        $('#wednesdayvege').text().toLowerCase(),
        $('#thursdayvege').text().toLowerCase(),
        $('#fridayvege').text().toLowerCase(),

        $('#mondayfruit4').text().toLowerCase(),
        $('#tuesdayfruit4').text().toLowerCase(),
        $('#wednesdayfruit4').text().toLowerCase(),
        $('#thursdayfruit4').text().toLowerCase(),
        $('#fridayfruit4').text().toLowerCase(),
    ];

    cellTexts.forEach(function(cellText) {
        yellowveg.forEach(function(veg) {
            if (cellText.includes(veg.toLowerCase())) {
                isYellowVegPresent = true;
                return false; // Exit the loop since we found a match
            }
        });
    });
   
    if (!isYellowVegPresent) {var cellIDs = [
        'mondayvege', 'tuesdayvege', 'wednesdayvege', 'thursdayvege', 'fridayvege',
    ];

    for (var i = 0; i < cellIDs.length; i++) {
        var cellText = $('#' + cellIDs[i]).text().trim().toLowerCase();
        var containsCheck = checks.some(function(check) {
            return cellText.includes(check.toLowerCase());
        });

        if (!containsCheck) {
            var randomYellowVeg = yellowveg[Math.floor(Math.random() * yellowveg.length)];
            $('#' + cellIDs[i]).text(randomYellowVeg);
            return;
        }
    }

    }
}

function updateBean(response) {
    var bean = ['Baked Beans'];
    var checks = ['Salad (Red Leaf, Green Leaf, Arugula, Chervil)','Yams', 'Carrots','Baked Beans'];
    var isBeanPresent = false;
    var cellTexts = [
        $('#mondayfruit').text().toLowerCase(),
        $('#tuesdayfruit').text().toLowerCase(),
        $('#wednesdayfruit').text().toLowerCase(),
        $('#thursdayfruit').text().toLowerCase(),
        $('#fridayfruit').text().toLowerCase(),

        $('#mondayfruit2').text().toLowerCase(),
        $('#tuesdayfruit2').text().toLowerCase(),
        $('#wednesdayfruit2').text().toLowerCase(),
        $('#thursdayfruit2').text().toLowerCase(),
        $('#fridayfruit2').text().toLowerCase(),

        $('#mondayvege').text().toLowerCase(),
        $('#tuesdayvege').text().toLowerCase(),
        $('#wednesdayvege').text().toLowerCase(),
        $('#thursdayvege').text().toLowerCase(),
        $('#fridayvege').text().toLowerCase(),

        $('#mondayfruit4').text().toLowerCase(),
        $('#tuesdayfruit4').text().toLowerCase(),
        $('#wednesdayfruit4').text().toLowerCase(),
        $('#thursdayfruit4').text().toLowerCase(),
        $('#fridayfruit4').text().toLowerCase(),
    ];

    cellTexts.forEach(function(cellText) {
        bean.forEach(function(ingredient) {
            if (cellText.includes(ingredient.toLowerCase())) {
                isBeanPresent = true;
                return false; // Exit the loop since we found a match
            }
        });
    });
   
    if (!isBeanPresent) {var cellIDs = [
        'mondayvege', 'tuesdayvege', 'wednesdayvege', 'thursdayvege', 'fridayvege',
    ];

    for (var i = 0; i < cellIDs.length; i++) {
        var cellText = $('#' + cellIDs[i]).text().trim().toLowerCase();
        var containsCheck = checks.some(function(check) {
            return cellText.includes(check.toLowerCase());
        });

        if (!containsCheck) {
            var randomBean = bean[Math.floor(Math.random() * bean.length)];
            $('#' + cellIDs[i]).text(randomBean);
            return;
        }
    }

    }
}



    function replaceDuplicateJuice() {
    var days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
    var fruits = ['fruit', 'fruit2', 'fruit3', 'fruit4'];
    var juiceKeyword = "juice"; // The keyword to search for in the fruit names

    days.forEach(function(day) {
        var seenJuices = new Set(); // To track if "Juice" has already been encountered

        fruits.forEach(function(fruit) {
            var cellID = '#' + day + fruit;
            var cellText = $(cellID).text().trim();
            var cellTextLower = cellText.toLowerCase();

            // If the cell contains "Juice"
            if (cellTextLower.includes(juiceKeyword)) {
                if (seenJuices.has(juiceKeyword)) {
                    // Replace the duplicate with "APPLE"
                    $(cellID).text("APPLE");
                } else {
                    seenJuices.add(juiceKeyword);
                }
            }
        });
    });
}
function replaceDuplicateJuice() {
    var days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
    var fruits = ['fruit', 'fruit2', 'fruit3', 'fruit4'];
    var juiceKeyword = "juice"; // The keyword to search for in the fruit names
    var replacementFruits = []; // Array to be populated dynamically

    // Fetch the list of fruits from the server
    $.get('/api/fruits/', function(data) {
        replacementFruits = data;

        days.forEach(function(day) {
            var seenJuices = new Set(); // To track if "Juice" has already been encountered

            fruits.forEach(function(fruit) {
                var cellID = '#' + day + fruit;
                var cellText = $(cellID).text().trim();
                var cellTextLower = cellText.toLowerCase();

                // If the cell contains "Juice"
                if (cellTextLower.includes(juiceKeyword)) {
                    if (seenJuices.has(juiceKeyword)) {
                        // Replace the duplicate with a random item from replacementFruits
                        var randomFruit = replacementFruits[Math.floor(Math.random() * replacementFruits.length)];
                        $(cellID).text(randomFruit);
                    } else {
                        seenJuices.add(juiceKeyword);
                    }
                }
            });
        });
    });
}


         
// Function to update the table with meals for each day
function updateTable(response) {
    // Days of the week
    var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

    // Loop through each day and update the table
    days.forEach(function(day) {
        var mealData = response[day];

        // Update the table cells for the day with meal name, grain, and meat alternate
        $('#' + day.toLowerCase() + 'Meals').text(mealData.meal_name);
        $('#' + day.toLowerCase() + 'Grain').text(mealData.grain);
        $('#' + day.toLowerCase() + 'MeatAlternate').text(mealData.meat_alternate);
        $('#' + day.toLowerCase() + 'Milk').text(mealData.fluid_milk); // Update fluid milk
        $('#' + day.toLowerCase() + 'LunchMilk').text(mealData.lunch_milk);
        $('#mondayLunchMilk').text('1% w.milk (unflavored)');
        $('#tuesdayLunchMilk').text('1% w.milk (unflavored)');
        $('#wednesdayLunchMilk').text('1% w.milk (unflavored)');
        $('#thursdayLunchMilk').text('1% w.milk (unflavored)');
        $('#fridayLunchMilk').text('1% w.milk (unflavored)');

        // Make the corresponding cells editable
        makeEditable($('#' + day.toLowerCase() + 'Meals'));
        makeEditable($('#' + day.toLowerCase() + 'Grain'));
        makeEditable($('#' + day.toLowerCase() + 'MeatAlternate'));
        makeEditable($('#' + day.toLowerCase() + 'Milk')); // Make fluid milk editable
        makeEditable($('#' + day.toLowerCase() + 'LunchMilk'));

        makeEditable($('#mondayadd2'));
        makeEditable($('#tuesdayadd2'));
        makeEditable($('#wednesdayadd2'));
        makeEditable($('#thursdayadd2'));
        makeEditable($('#fridayadd2'));

        // Check if "(WG)" or "(WW)" is present in any relevant cells
        var isWGWWPresent = false;

        // Relevant cell IDs
        var cellIDs = [
            '#' + day.toLowerCase() + 'bread',
            '#' + day.toLowerCase() + 'add1',
            '#' + day.toLowerCase() + 'bread2',
            '#' + day.toLowerCase() + 'add2',
            '#' + day.toLowerCase() + 'bread3'
        ];

        // Loop through each cell
        cellIDs.forEach(function(cellID) {
            var cellText = $(cellID).text().toLowerCase();
            if (cellText.includes("(wg)") || cellText.includes("(ww)")) {
                isWGWWPresent = true;
                return false; // Exit the loop since we found a match
            }
        });

        // Check grain cell separately
        var grainCellText = $('#' + day.toLowerCase() + 'Grain').text().toLowerCase();
        if (grainCellText.includes("(wg)") || grainCellText.includes("(ww)")) {
            isWGWWPresent = true;
        }

        // Add "(WW) Bread" if necessary
        if (!isWGWWPresent) {
            $('#' + day.toLowerCase() + 'add1').text('(WW) Toast');
        } else {
            // Remove "(WW) Bread" if it's unnecessary
            if ($('#' + day.toLowerCase() + 'add1').text().trim().toLowerCase() === '(ww) bread') {
                $('#' + day.toLowerCase() + 'add1').text('');
            }
        }
    });
    updateBerries(response);
    updateLeafyGreen(response);
    updateYellowVeg(response);
    updateBean(response);
    replaceDuplicateJuice();
}

 function updateAMTable(response) {
     // Days of the week
     var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
 
     // Loop through each day and update the table
     days.forEach(function(day) {
         var amData = response[day];
         // Update the table cells for the AM menu
         $('#' + day.toLowerCase() + 'choose1').text(amData.choose1);
         $('#' + day.toLowerCase() + 'fruit2').text(amData.fruit2);
         $('#' + day.toLowerCase() + 'bread2').text(amData.bread2);
         $('#' + day.toLowerCase() + 'meat1').text(amData.meat1);
 
         // Make the corresponding cells editable if needed
         makeEditable($('#' + day.toLowerCase() + 'choose1'));
         makeEditable($('#' + day.toLowerCase() + 'fruit2'));
         makeEditable($('#' + day.toLowerCase() + 'bread2'));
         makeEditable($('#' + day.toLowerCase() + 'meat1'));
     });
 }
 
 
 function updatePMTable(response) {
     // Days of the week
     var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
 
     // Loop through each day and update the table
     days.forEach(function(day) {
         var pmData = response[day];
         // Update the table cells for the PM snack
         $('#'+day.toLowerCase()+'choose2').text(pmData.choose2);
         $('#'+day.toLowerCase()+'fruit4').text(pmData.fruit4);
         $('#'+day.toLowerCase()+'bread3').text(pmData.bread3);
         $('#'+day.toLowerCase()+'meat3').text(pmData.meat3);
 
         // Make the corresponding cells editable
         makeEditable($('#'+day.toLowerCase()+'choose2'));
         makeEditable($('#'+day.toLowerCase()+'fruit4'));
         makeEditable($('#'+day.toLowerCase()+'bread3'));
         makeEditable($('#'+day.toLowerCase()+'meat3'));
     });
 }
 function updateBreakfastTable(response) {
     // Days of the week
     var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
 
     // Loop through each day and update the breakfast table
     days.forEach(function(day) {
         var breakfastData = response[day];
 
         // Update the table cells for the day with breakfast details
         $('#' + day.toLowerCase() + 'bread').text(breakfastData.bread);
         $('#' + day.toLowerCase() + 'add1').text(breakfastData.add1);
         $('#mondayMilk').text('1% w.milk (unflavored)');
         $('#tuesdayMilk').text('1% w.milk (unflavored)');
         $('#wednesdayMilk').text('1% w.milk (unflavored)');
         $('#thursdayMilk').text('1% w.milk (unflavored)');
         $('#fridayMilk').text('1% w.milk (unflavored)');
 
         // Make the corresponding cells editable
         makeEditable($('#' + day.toLowerCase() + 'bread'));
         makeEditable($('#' + day.toLowerCase() + 'add1'));
     });
 }
 function updateFruitTable(response) {
     // Days of the week
     var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
 
     // Loop through each day and update the table
     days.forEach(function(day) {
         var fruitData = response[day];
        
         // Update the table cells for the day with fruit
         $('#' + day.toLowerCase() + 'fruit').text(fruitData.fruit);
         
         // Make the corresponding cell editable if needed
         makeEditable($('#' + day.toLowerCase() + 'fruit'));
         
         // If the element corresponds to 'fruit3', update it with a different fruit
         if (fruitData.fruit3) {
             $('#' + day.toLowerCase() + 'fruit3').text(fruitData.fruit3);
             
         }
        makeEditable($('#' + day.toLowerCase() + 'fruit3'));
     });
 }
 
 function updateVegetableTable(response) {
     // Days of the week
     var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
 
     // Loop through each day and update the table
     days.forEach(function(day) {
         var vegetableData = response[day];
        
         // Update the table cells for the day with vegetable
         $('#' + day.toLowerCase() + 'vege').text(vegetableData.vegetable);
        
         // Make the corresponding cells editable if needed
         makeEditable($('#' + day.toLowerCase() + 'vege'));
   
     });
 }
         // Function to make a table cell editable
         function makeEditable(cell) {
             cell.click(function() {
                 var currentText = cell.text().trim();
                 var inputField = $('<input>').val(currentText).addClass('input-box form-control');
                 cell.html(inputField);
                 inputField.focus();
 
                 // Handle blur event to save the edited content
                 inputField.blur(function() {
                     var editedText = inputField.val().trim();
                     cell.text(editedText);
                 });
             });
         }
         // Function to get CSRF token from cookies
         function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie !== '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = cookies[i].trim();
                     // Does this cookie string begin with the name we want?
                     if (cookie.substring(0, name.length + 1) === (name + '=')) {
                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                         break;
                     }
                 }
             }
             return cookieValue;
         }
         function updateDates() {
    var today = new Date(); // Get today's date
    var currentDayIndex = today.getDay(); // Get the index of today's day (0: Sunday, 1: Monday, ..., 6: Saturday)
    var daysUntilNextMonday = (currentDayIndex === 0) ? 1 : (8 - currentDayIndex); // Calculate days until next Monday

    var nextMonday = new Date(today);
    nextMonday.setDate(today.getDate() + daysUntilNextMonday); // Set next Monday's date

    var nextFriday = new Date(nextMonday);
    nextFriday.setDate(nextMonday.getDate() + 4); // Set next Friday's date by adding 4 days to next Monday

    // Format start date (Monday) and end date (Friday)
    var startDateString = ('0' + (nextMonday.getMonth() + 1)).slice(-2) + '/' + ('0' + nextMonday.getDate()).slice(-2);
    var endDateString = ('0' + (nextFriday.getMonth() + 1)).slice(-2) + '/' + ('0' + nextFriday.getDate()).slice(-2);

    // Update the "Weekly Menu: Date - Date" header
    $('#weeklyMenuHeader').text('Weekly Menu: ' + startDateString + ' - ' + endDateString);

    // Loop through each weekday and update the date
    $('.weekday-date').each(function(index) {
        var date = new Date(nextMonday);
        date.setDate(nextMonday.getDate() + index); // Calculate the date for the weekday

        // Format the date as MM/DD
        var formattedDate = ('0' + (date.getMonth() + 1)).slice(-2) + '/' + ('0' + date.getDate()).slice(-2);

        // Update the date under the weekday
        $(this).text(formattedDate);
    });

    // Store the next Monday date in a global variable or data attribute
    window.nextMondayDate = nextMonday; // Store for later use
}
async function checkMenuExistsAndSave() {
    // Create an array of dates to check based on stored next Monday
    const datesToCheck = [];
    const nextMonday = window.nextMondayDate; // Get the stored next Monday date

    for (let i = 0; i < 5; i++) {
        const date = new Date(nextMonday);
        date.setDate(nextMonday.getDate() + i);
        // Format date as YYYY-MM-DD
        const formattedDate = date.toISOString().split('T')[0]; // Get YYYY-MM-DD format
        datesToCheck.push(formattedDate);
    }

    // Fetch existing menu data to check for entries
    const response = await fetch('/api/check_menu/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ dates: datesToCheck })
    });

    const result = await response.json();

    // If the menu already exists for those dates
    if (result.exists) {
        toastr.warning(
            "There is already a menu saved for these dates. Saving will override previous entries. <br><br> <button type='button' class='btn btn-primary btn-sm' id='confirmSave'>Proceed</button> <button type='button' class='btn btn-secondary btn-sm' id='cancelSave'>Cancel</button>",
            "Warning",
            {
                allowHtml: true,
                closeButton: true,
                timeOut: 0, // Disable auto-dismiss
                extendedTimeOut: 0,
                tapToDismiss: false,
                onShown: function () {
                    document.getElementById('confirmSave').addEventListener('click', function () {
                        toastr.clear(); // Clear the Toastr notification
                        saveMenu(); // Proceed with saving the menu
                    });
                    document.getElementById('cancelSave').addEventListener('click', function () {
                        toastr.clear(); // Clear the Toastr notification
                        toastr.info("Menu not saved."); // Optional: Inform the user
                    });
                }
            }
        );
    } else {
        saveMenu(); // No existing entries, proceed to save
    }
}

function saveMenu() {
    let menuData = {
        monday: {
            am_fluid_milk: document.getElementById('mondayMilk').innerText,
            am_fruit_veg: document.getElementById('mondayfruit').innerText,
            am_bread: document.getElementById('mondaybread').innerText,
            am_additional: document.getElementById('mondayadd1').innerText,
            ams_fluid_milk: document.getElementById('mondaychoose1').innerText,
            ams_fruit_veg: document.getElementById('mondayfruit2').innerText,
            ams_bread: document.getElementById('mondaybread2').innerText,
            ams_meat: document.getElementById('mondaymeat1').innerText,
            lunch_main_dish: document.getElementById('mondayMeals').innerText,
            lunch_fluid_milk: document.getElementById('mondayLunchMilk').innerText,
            lunch_vegetable: document.getElementById('mondayvege').innerText,
            lunch_fruit: document.getElementById('mondayfruit3').innerText,
            lunch_grain: document.getElementById('mondayGrain').innerText,
            lunch_meat: document.getElementById('mondayMeatAlternate').innerText,
            lunch_additional: document.getElementById('mondayadd2').innerText,
            pm_fluid_milk: document.getElementById('mondaychoose2').innerText,
            pm_fruit_veg: document.getElementById('mondayfruit4').innerText,
            pm_bread: document.getElementById('mondaybread3').innerText,
            pm_meat: document.getElementById('mondaymeat3').innerText
        },
        tuesday: {
            am_fluid_milk: document.getElementById('tuesdayMilk').innerText,
            am_fruit_veg: document.getElementById('tuesdayfruit').innerText,
            am_bread: document.getElementById('tuesdaybread').innerText,
            am_additional: document.getElementById('tuesdayadd1').innerText,
            ams_fluid_milk: document.getElementById('tuesdaychoose1').innerText,
            ams_fruit_veg: document.getElementById('tuesdayfruit2').innerText,
            ams_bread: document.getElementById('tuesdaybread2').innerText,
            ams_meat: document.getElementById('tuesdaymeat1').innerText,
            lunch_main_dish: document.getElementById('tuesdayMeals').innerText,
            lunch_fluid_milk: document.getElementById('tuesdayLunchMilk').innerText,
            lunch_vegetable: document.getElementById('tuesdayvege').innerText,
            lunch_fruit: document.getElementById('tuesdayfruit3').innerText,
            lunch_grain: document.getElementById('tuesdayGrain').innerText,
            lunch_meat: document.getElementById('tuesdayMeatAlternate').innerText,
            lunch_additional: document.getElementById('tuesdayadd2').innerText,
            pm_fluid_milk: document.getElementById('tuesdaychoose2').innerText,
            pm_fruit_veg: document.getElementById('tuesdayfruit4').innerText,
            pm_bread: document.getElementById('tuesdaybread3').innerText,
            pm_meat: document.getElementById('tuesdaymeat3').innerText
        },
        wednesday: {
            am_fluid_milk: document.getElementById('wednesdayMilk').innerText,
            am_fruit_veg: document.getElementById('wednesdayfruit').innerText,
            am_bread: document.getElementById('wednesdaybread').innerText,
            am_additional: document.getElementById('wednesdayadd1').innerText,
            ams_fluid_milk: document.getElementById('wednesdaychoose1').innerText,
            ams_fruit_veg: document.getElementById('wednesdayfruit2').innerText,
            ams_bread: document.getElementById('wednesdaybread2').innerText,
            ams_meat: document.getElementById('wednesdaymeat1').innerText,
            lunch_main_dish: document.getElementById('wednesdayMeals').innerText,
            lunch_fluid_milk: document.getElementById('wednesdayLunchMilk').innerText,
            lunch_vegetable: document.getElementById('wednesdayvege').innerText,
            lunch_fruit: document.getElementById('wednesdayfruit3').innerText,
            lunch_grain: document.getElementById('wednesdayGrain').innerText,
            lunch_meat: document.getElementById('wednesdayMeatAlternate').innerText,
            lunch_additional: document.getElementById('wednesdayadd2').innerText,
            pm_fluid_milk: document.getElementById('wednesdaychoose2').innerText,
            pm_fruit_veg: document.getElementById('wednesdayfruit4').innerText,
            pm_bread: document.getElementById('wednesdaybread3').innerText,
            pm_meat: document.getElementById('wednesdaymeat3').innerText
        },
        thursday: {
            am_fluid_milk: document.getElementById('thursdayMilk').innerText,
            am_fruit_veg: document.getElementById('thursdayfruit').innerText,
            am_bread: document.getElementById('thursdaybread').innerText,
            am_additional: document.getElementById('thursdayadd1').innerText,
            ams_fluid_milk: document.getElementById('thursdaychoose1').innerText,
            ams_fruit_veg: document.getElementById('thursdayfruit2').innerText,
            ams_bread: document.getElementById('thursdaybread2').innerText,
            ams_meat: document.getElementById('thursdaymeat1').innerText,
            lunch_main_dish: document.getElementById('thursdayMeals').innerText,
            lunch_fluid_milk: document.getElementById('thursdayLunchMilk').innerText,
            lunch_vegetable: document.getElementById('thursdayvege').innerText,
            lunch_fruit: document.getElementById('thursdayfruit3').innerText,
            lunch_grain: document.getElementById('thursdayGrain').innerText,
            lunch_meat: document.getElementById('thursdayMeatAlternate').innerText,
            lunch_additional: document.getElementById('thursdayadd2').innerText,
            pm_fluid_milk: document.getElementById('thursdaychoose2').innerText,
            pm_fruit_veg: document.getElementById('thursdayfruit4').innerText,
            pm_bread: document.getElementById('thursdaybread3').innerText,
            pm_meat: document.getElementById('thursdaymeat3').innerText
        },
        friday: {
            am_fluid_milk: document.getElementById('fridayMilk').innerText,
            am_fruit_veg: document.getElementById('fridayfruit').innerText,
            am_bread: document.getElementById('fridaybread').innerText,
            am_additional: document.getElementById('fridayadd1').innerText,
            ams_fluid_milk: document.getElementById('fridaychoose1').innerText,
            ams_fruit_veg: document.getElementById('fridayfruit2').innerText,
            ams_bread: document.getElementById('fridaybread2').innerText,
            ams_meat: document.getElementById('fridaymeat1').innerText,
            lunch_main_dish: document.getElementById('fridayMeals').innerText,
            lunch_fluid_milk: document.getElementById('fridayLunchMilk').innerText,
            lunch_vegetable: document.getElementById('fridayvege').innerText,
            lunch_fruit: document.getElementById('fridayfruit3').innerText,
            lunch_grain: document.getElementById('fridayGrain').innerText,
            lunch_meat: document.getElementById('fridayMeatAlternate').innerText,
            lunch_additional: document.getElementById('fridayadd2').innerText,
            pm_fluid_milk: document.getElementById('fridaychoose2').innerText,
            pm_fruit_veg: document.getElementById('fridayfruit4').innerText,
            pm_bread: document.getElementById('fridaybread3').innerText,
            pm_meat: document.getElementById('fridaymeat3').innerText
        }
    };

    $.ajax({
        url: '/save-menu/',
        type: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json'
        },
        data: JSON.stringify(menuData),  // menuData being the object with the menu details
        success: function (response) {
            toastr.success('Menu saved successfully!');
        },
        error: function (error) {
            toastr.error('Error saving menu: ' + error.statusText);
        }
    });
}

// Bind the event correctly to call the check function
document.getElementById('saveMenuBtn').addEventListener('click', function(event) {
    event.preventDefault(); // Prevent the default form submission
    console.log('Save Menu button clicked');
    checkMenuExistsAndSave(); // Call the check function when the button is clicked
});
});



function updateMenuTable() {
    const selectedRange = document.getElementById("dateRangeSelect").value;
    // Logic to update the menu table based on selected date range
    // You may want to perform an AJAX request to fetch the specific weekly menu data
}



 </script>
 <script>
    window.onload = function() {
        const today = new Date();
        const pastWeekdays = [];
        let count = 0;

        for (let i = 1; count < 5; i++) {
            const day = new Date(today);
            day.setDate(today.getDate() - i);
            if (day.getDay() !== 0 && day.getDay() !== 6) { // 0 = Sunday, 6 = Saturday
                pastWeekdays.push(day.toLocaleDateString('en-US', { month: 'short', day: '2-digit' }));
                count++;
            }
        }

        const dateRangeSelect = document.getElementById('dateRangeSelect');
        for (let i = 0; i < pastWeekdays.length - 1; i++) {
            const option = document.createElement('option');
            option.value = `${pastWeekdays[i]} - ${pastWeekdays[i + 1]}`;
            option.text = `${pastWeekdays[i]} - ${pastWeekdays[i + 1]}`;
            dateRangeSelect.add(option);
        }
    }
</script>
{% endblock %}
